@model _3dsGallery.DataLayer.DataBase.GalleryContext
@{
    ViewBag.Title = "Home";
    int gallery_count = Request.UserAgent.Contains("Nintendo 3DS") ? 2 : 3;
    int picture_count = Request.UserAgent.Contains("Nintendo 3DS") ? 3 : 12;
}

<div id="banner-section">
    <div class="container body-content text-center">
        <div class="h1">
            3DS Gallery
        </div>
        <p id="banner-tagline"></p>
    </div>
</div>

<div class="section-white">
    <div class="container body-content">
        <div class="h2-container">
            <a href="@Url.Action("Index", "Gallery")" class="btn btn-success pull-right">View all</a>
            <h2 class="text-success">Latest Updates</h2>
        </div>
        <div class="row">

            @*<div class="col-md-4">
                    <div class="panel panel-nocturnal-purple">
                        <div class="panel-heading">
                            <div class="gallery-badges">
                                <span class="badge">3D</span>
                                <span class="badge">99</span>
                            </div>
                            <div class="one-line">
                                <a href="" class="btn btn-nocturnal-purple btn-add">+</a>
                                <a href="" class="gallery-name">Test gallery element</a>
                            </div>
                        </div>
                        <div class="panel-body preview-gallery">
                            <div class="preview-container-sm">
                                <img class="img-thumbnail preview-img">
                            </div>
                            <div class="preview-container-sm">
                                <img class="img-thumbnail preview-img">
                            </div>
                        </div>
                        <div class="panel-heading gallery-info">
                            <a href=""><i>Username</i></a>
                        </div>
                    </div>
                </div>*@

            @{ Html.RenderAction("GetElements", "Gallery", new { items = Model.Gallery.Where(x => x.LastPicture != null && (!x.IsPrivate || (x.IsPrivate && x.User.login == User.Identity.Name))).OrderByDescending(x => x.LastPicture.id).Take(gallery_count).ToList() }); }
        </div>
    </div>
</div>

<div class="section-grey">
    <div class="container body-content">
        <div class="h2-container">
            <a href="@Url.Action("Index", "Picture")" class="btn btn-info pull-right">View all</a>
            <h2 class="text-info">Latest Images</h2>
        </div>
        <div class="row">
            @{ Html.RenderAction("GetElements", "Picture", new { items = Model.Picture.Where(x => !x.Gallery.IsPrivate || (x.Gallery.IsPrivate && x.Gallery.User.login == User.Identity.Name)).OrderByDescending(x => x.id).Take(picture_count).ToList() }); }
        </div>
    </div>
</div>

@section scripts {
    @RenderPage("~/Views/Shared/MainScripts.cshtml")

<script>
    var styles = [
        { name: 'Slate Grey', code: 'default', codeEx: 'slate-gray' },
        { name: 'Sky Blue', code: 'info', codeEx: 'sky-blue' },
        { name: 'Grass Green', code: 'success', codeEx: 'grass-green' },
        { name: 'Rusty Orange', code: 'warning', codeEx: 'rusty-orange' },
        { name: 'Sweet Pink', code: 'sweet-pink' },
        { name: 'Nocturnal Purple', code: 'nocturnal-purple' }
    ];

    var messages = {
        common: ["Share your pics straight from a Nintendo 3DS Internet Browser!",
            "Publish your lo-fi 0.3MP photos using a Nintendo 3DS Internet Browser",
            "Upload your images online using only Nintendo 3DS Internet Browser",
            "Developed for Nintendo 3DS Internet Browser",
            "No need to take out an SD card to transfer some pics. Just Nintendo 3DS Internet Browser... and a Wi-Fi connection",
            "Feel free to share what you draw in Colors3D, ArtAcademy, or any other apps",
            "Maybe upload some funny moments from Tomodachi Life or ACNL",
            "Private Galleries are now available to use",
            "You may see a strange/unique message here. Means it's rare",
            "You can always access 3DS Gallery from your phone to save and share your uploads"],
        uncommon: ["Every image here is clickable! And if you press it using a 3DS - it might open in a glorious 3D",
            "Use a 3D indicator on the images and galleries to locate some stereoscopic goodness",
            "3D pictures are saved in it's original format, and you can view them in 3D on a 3DS, VR, 3D Monitors",
            "Use the Filter feature on the top-right corner where there's pics or galleries. Even I forget that such feature exists",
            "3DS Gallery does not have any ads or tracking scripts that steals your data. That's cool, huh?",
            "Type up to 150 symbols for a pic/gallery description. You can also do it later from ur phone",
            "The total amount of likes you earned is shown next to your nickname. It doesn't affect anything tho.",
            "No need to enter your Email or any personal info while creating an account. Feel free to sign up if you haven't already.",
            "See a lovely pic? Give it a like! Go to your profile page to view it later",
            "Enjoying the colors of this section? It's called //style_name//, and you can use if for you Gallery!"],
        rare: ["Nintendo 3DS was released //2011-02-26// ago. Feeling old yet?",
            "EShop was closed //2023-03-27// ago",
            "I didn't feed my Nintendog for //2021-12-22//",
            "Shiggy was born //1952-11-16// ago",
            "Hidden indie gem Celeste came out //2018-01-25// ago",
            "Masahiro Sakurai was born //1970-08-03// ago. He once said he only drinks Coke Zero since he dislikes water. Elixir of youth? Probably not lmao",
            "Hideo Kojima was born //1963-08-24// ago. His game Metal Gear Solid 3 came out on a 3DS and it features an in-game Camera that u can use",
            "Satoru Iwata passed away //2015-07-11// ago. The console you're holding came out under his supervision",
            "You love Pokemon, huh? Then upload all 802 of them from USUM. Don't forget the shiny ones",
            "I bought lime, it was green lemon",
            "Sometimes cocojumbo means something more",
            "Funny rabits with bloody eyes on balloons",
            "The Universe was born 13,8 billion years ago",
            "More updates are coming: more color themes, multiple uploads, \"Picture of the Day\" feature, QOL improvements",
            "This site was made using now old ASP.NET MVC tech, along with HTML, CSS, JS, JQuery, BootStrap, C#, EntityFramework. Hosted on a free Azure service"],
        legendary: ["WOW! You got the rarest message! Chances were 1 in 1000 (0.1%). It could be you lucky day, maybe get a lotto?"]
    };

    function replaceDateWithDiff(str) {
        // Extract the date between //...//
        var match = str.match(/\/\/(\d{4}-\d{2}-\d{2})\/\//);
        if (!match) return str;

        var releaseDate = new Date(match[1]);
        var today = new Date();

        // Calculate difference in milliseconds
        var diffMs = today - releaseDate;

        // Convert to days
        var diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

        // Break down into years, months, days
        var years = Math.floor(diffDays / 365);
        diffDays -= years * 365;

        var months = Math.floor(diffDays / 30); // approximate months
        diffDays -= months * 30;

        // Build result parts
        var parts = [];
        if (years > 0) parts.push(years + "y");
        if (months > 0) parts.push(months + "m");
        if (diffDays > 0) parts.push(diffDays + "d");

        // Format with commas and "and"
        var result;
        if (parts.length === 1) {
            result = parts[0];
        } else if (parts.length === 2) {
            result = parts[0] + " and " + parts[1];
        } else if (parts.length === 3) {
            result = parts[0] + ", " + parts[1] + " and " + parts[2];
        } else {
            result = "";
        }

        // Replace the original date with the result
        return str.replace(/\/\/\d{4}-\d{2}-\d{2}\/\//, result);
    }

    function getRandomCategory() {
        var categories = [
            { type: "common", weight: 0.7 },
            { type: "uncommon", weight: 0.2 },
            { type: "rare", weight: 0.099 },
            { type: "legendary", weight: 0.001 }
        ];

        var rand = Math.random();
        var cumulative = 0;

        for (var i = 0; i < categories.length; i++) {
            cumulative += categories[i].weight;
            if (rand < cumulative) {
                return categories[i].type;
            }
        }
    }

    function getRandomMessage() {
        var category = getRandomCategory();
        var options = messages[category];
        return options[Math.floor(Math.random() * options.length)];
    }

    $(function () {

        var randomStyle = styles[Math.floor(Math.random() * styles.length)];

        $('#banner-section')
            .addClass('section-' + (randomStyle.codeEx ? randomStyle.codeEx : randomStyle.code))
            .addClass('text-' + randomStyle.code);

        var msg = replaceDateWithDiff(getRandomMessage());
        var msg = msg.replace('//style_name//', randomStyle.name);

        $('#banner-tagline').text(msg);
    })
</script>
}
